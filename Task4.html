<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaskCraft - Smart Task Management</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --bg-light: #f8fafc;
      --text-light: #334155;
      --bg-dark: #0f172a;
      --text-dark: #e2e8f0;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --accent-light: #bfdbfe;
      --high: #ef4444;
      --medium: #f59e0b;
      --low: #10b981;
      --card-bg-light: rgba(255, 255, 255, 0.85);
      --card-bg-dark: rgba(30, 41, 59, 0.85);
      --card-shadow-light: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      --card-shadow-dark: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      --transition-speed: 0.3s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background-color var(--transition-speed), color var(--transition-speed);
      min-height: 100vh;
      background-image: url('pic.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      transition: background var(--transition-speed);
    }

    body.dark-mode {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      background-image: url('pic.jpg');
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 2rem;
      background-color: var(--card-bg-light);
      border-radius: 16px;
      box-shadow: var(--card-shadow-light);
      transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0) 70%);
      z-index: -1;
      opacity: 0.8;
      animation: pulse 15s infinite alternate;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 0.5;
      }
      100% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    body.dark-mode .container {
      background-color: var(--card-bg-dark);
      box-shadow: var(--card-shadow-dark);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 150%;
      z-index: -1;
      border-radius: 50%;
      transform: translateY(-30%);
    }

    h1 {
      font-family: 'Poppins', sans-serif;
      color: var(--accent);
      font-size: 2.25rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-shadow: 0 2px 10px rgba(59, 130, 246, 0.2);
    }

    .toggle-dark {
      background-color: var(--accent);
      border: none;
      color: white;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color var(--transition-speed), transform 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
    }

    .toggle-dark:hover {
      background-color: var(--accent-hover);
      transform: translateY(-2px);
    }

    .toggle-dark:active {
      transform: translateY(0);
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background-color: rgba(59, 130, 246, 0.1);
      padding: 1rem;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .stat-card {
      background-color: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 0.25rem;
      text-shadow: 0 2px 10px rgba(59, 130, 246, 0.2);
    }

    .stat-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-light);
      transition: color var(--transition-speed);
    }

    body.dark-mode .stat-label {
      color: var(--text-dark);
    }

    /* Main content layout - two column */
    .content-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .left-panel {
      display: flex;
      flex-direction: column;
    }

    .right-panel {
      display: flex;
      flex-direction: column;
    }

    .add-task-panel {
      background-color: var(--card-bg-light);
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: background-color var(--transition-speed), border-color var(--transition-speed);
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.1);
      height: 100%;
    }

    body.dark-mode .add-task-panel {
      background-color: var(--card-bg-dark);
      border-color: rgba(255, 255, 255, 0.05);
      box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.2);
    }

    .input-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .input-group input,
    .input-group select,
    .input-group textarea {
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(209, 213, 219, 0.6);
      font-size: 0.95rem;
      background: rgba(255, 255, 255, 0.9);
      transition: border-color var(--transition-speed), background-color var(--transition-speed);
      backdrop-filter: blur(4px);
    }

    body.dark-mode .input-group input,
    body.dark-mode .input-group select,
    body.dark-mode .input-group textarea {
      background-color: rgba(51, 65, 85, 0.9);
      border-color: rgba(71, 85, 105, 0.6);
      color: var(--text-dark);
    }

    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    }

    .input-group textarea {
      grid-column: span 2;
      resize: vertical;
      min-height: 80px;
    }

    .reminder-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }

    .reminder-toggle input[type="checkbox"] {
      cursor: pointer;
    }

    .reminder-fields {
      display: flex;
      gap: 1rem;
      transition: all 0.3s;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .reminder-fields.hidden {
      max-height: 0;
      margin-bottom: 0;
      opacity: 0;
    }

    .reminder-fields.visible {
      max-height: 50px;
      opacity: 1;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
    }

    .btn {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: background-color var(--transition-speed), transform 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px -1px rgba(0, 0, 0, 0.15);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background-color: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--accent-hover);
    }

    .btn-secondary {
      background-color: rgba(255, 255, 255, 0.5);
      color: var(--text-light);
      border: 1px solid rgba(209, 213, 219, 0.6);
      backdrop-filter: blur(4px);
    }

    body.dark-mode .btn-secondary {
      background-color: rgba(51, 65, 85, 0.5);
      color: var(--text-dark);
      border-color: rgba(71, 85, 105, 0.6);
    }

    .btn-secondary:hover {
      background-color: rgba(255, 255, 255, 0.7);
    }

    body.dark-mode .btn-secondary:hover {
      background-color: rgba(51, 65, 85, 0.7);
    }

    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1rem;
      align-items: center;
    }

    .filter-group input,
    .filter-group select {
      padding: 0.65rem 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(209, 213, 219, 0.6);
      font-size: 0.95rem;
      background-color: rgba(255, 255, 255, 0.7);
      transition: border-color var(--transition-speed), background-color var(--transition-speed);
      backdrop-filter: blur(4px);
    }

    body.dark-mode .filter-group input,
    body.dark-mode .filter-group select {
      background-color: rgba(51, 65, 85, 0.7);
      border-color: rgba(71, 85, 105, 0.6);
      color: var(--text-dark);
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    }

    .progress-container {
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.6);
      border-radius: 12px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: background-color var(--transition-speed);
      margin-bottom: 1rem;
    }

    body.dark-mode .progress-container {
      background-color: rgba(30, 41, 59, 0.6);
      border-color: rgba(255, 255, 255, 0.05);
    }

    .progress-bar {
      height: 8px;
      background-color: rgba(226, 232, 240, 0.6);
      border-radius: 4px;
      overflow: hidden;
      transition: background-color var(--transition-speed);
      backdrop-filter: blur(4px);
    }

    body.dark-mode .progress-bar {
      background-color: rgba(51, 65, 85, 0.6);
    }

    .progress {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-hover));
      transition: width 0.5s ease;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    .progress-stats {
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-light);
      display: flex;
      justify-content: space-between;
      transition: color var(--transition-speed);
    }

    body.dark-mode .progress-stats {
      color: var(--text-dark);
    }

    .task-list-container {
      border-radius: 12px;
      overflow: hidden;
      height: 100%;
    }

    #taskList {
      list-style: none;
      padding: 0;
      max-height: 70vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) transparent;
    }

    #taskList::-webkit-scrollbar {
      width: 6px;
    }

    #taskList::-webkit-scrollbar-track {
      background: transparent;
    }

    #taskList::-webkit-scrollbar-thumb {
      background-color: var(--accent);
      border-radius: 10px;
    }

    .task-item {
      background-color: rgba(255, 255, 255, 0.7);
      padding: 1.25rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      transition: transform 0.2s, box-shadow 0.2s, background-color var(--transition-speed);
      cursor: move;
      position: relative;
      border-left: 4px solid var(--accent);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(8px);
    }

    body.dark-mode .task-item {
      background-color: rgba(30, 41, 59, 0.7);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }

    .task-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .task-item:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    }

    .priority-High {
      border-left-color: var(--high);
    }

    .priority-Medium {
      border-left-color: var(--medium);
    }

    .priority-Low {
      border-left-color: var(--low);
    }

    .task-item.completed {
      opacity: 0.7;
    }

    .task-item.completed .task-title {
      text-decoration: line-through;
      color: #6b7280;
    }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .task-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin: 0;
      transition: color var(--transition-speed);
    }

    .task-details {
      margin: 0.75rem 0;
      font-size: 0.95rem;
      color: #6b7280;
      line-height: 1.5;
      transition: color var(--transition-speed);
    }

    body.dark-mode .task-details {
      color: #94a3b8;
    }

    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 0.75rem 0;
      font-size: 0.85rem;
    }

    .task-meta-item {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      color: #64748b;
      transition: color var(--transition-speed);
    }

    body.dark-mode .task-meta-item {
      color: #94a3b8;
    }

    .task-priority {
      font-weight: 600;
    }

    .priority-High .task-priority {
      color: var(--high);
    }

    .priority-Medium .task-priority {
      color: var(--medium);
    }

    .priority-Low .task-priority {
      color: var(--low);
    }

    .task-controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .task-btn {
      background: transparent;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.4rem;
      border-radius: 6px;
      color: #64748b;
      transition: background-color 0.2s, color 0.2s, transform 0.2s;
    }

    .task-btn:hover {
      background-color: rgba(0, 0, 0, 0.05);
      color: var(--accent);
      transform: translateY(-2px);
    }

    body.dark-mode .task-btn:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .task-btn:active {
      transform: translateY(0);
    }

    .btn-edit {
      color: var(--accent);
    }

    .btn-complete {
      color: var(--low);
    }

    .btn-delete {
      color: var(--high);
    }

    .task-category {
      position: absolute;
      top: 1.25rem;
      right: 1.25rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      background-color: var(--accent-light);
      color: var(--accent);
      backdrop-filter: blur(4px);
    }

    .category-Work {
      background-color: rgba(16, 185, 129, 0.2);
      color: var(--low);
    }

    .category-Personal {
      background-color: rgba(245, 158, 11, 0.2);
      color: var(--medium);
    }

    .category-Urgent {
      background-color: rgba(239, 68, 68, 0.2);
      color: var(--high);
    }

    .reminder-badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background-color: var(--medium);
      color: white;
      border-radius: 50%;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      backdrop-filter: blur(4px);
    }

    .modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background-color: var(--card-bg-light);
      border-radius: 12px;
      padding: 2rem;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      transform: translateY(20px);
      transition: transform 0.3s, background-color var(--transition-speed);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    body.dark-mode .modal {
      background-color: var(--card-bg-dark);
      border-color: rgba(255, 255, 255, 0.05);
    }

    .modal-overlay.visible .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
      transition: color 0.2s;
    }

    body.dark-mode .modal-close {
      color: var(--text-dark);
    }

    .modal-close:hover {
      color: var(--high);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    /* Notification toast */
    .notification-toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background-color: var(--card-bg-light);
      color: var(--text-light);
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      max-width: 350px;
      z-index: 1100;
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
      border-left: 4px solid var(--accent);
      backdrop-filter: blur(8px);
    }

    body.dark-mode .notification-toast {
      background-color: var(--card-bg-dark);
      color: var(--text-dark);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
    }

    .notification-toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-toast.high {
      border-left-color: var(--high);
    }

    .notification-toast.medium {
      border-left-color: var(--medium);
    }

    .notification-toast-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-toast-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .notification-toast-close {
      background: transparent;
      border: none;
      cursor: pointer;
      color: inherit;
      font-size: 1.1rem;
    }

    .notification-toast-body {
      font-size: 0.9rem;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #64748b;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--accent);
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .empty-state p {
      font-size: 0.95rem;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Time in dashboard */
    .current-time {
      font-weight: 600;
      margin-top: 0.25rem;
      font-size: 1.25rem;
      color: var(--accent);
    }

    /* Responsive styles */
    @media (max-width: 992px) {
      .content-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .container {
        margin: 1rem;
        padding: 1.5rem;
      }

      h1 {
        font-size: 1.75rem;
      }

      .input-group {
        grid-template-columns: 1fr;
      }

      .input-group textarea {
        grid-column: span 1;
      }

      .filter-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .notification-toast {
        left: 1rem;
        right: 1rem;
        max-width: unset;
      }

      .content-container {
        gap: 1rem;
      }
    }

    /* Shake animation for invalid inputs */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    .shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-check-circle"></i> To Do</h1>
      <button class="toggle-dark" onclick="toggleDarkMode()">
        <i class="fas fa-moon" id="theme-icon"></i>
        <span id="theme-text">Dark Mode</span>
      </button>
    </header>

    <div class="dashboard">
      <div class="stat-card">
        <div class="stat-value" id="tasksTotal">0</div>
        <div class="stat-label">Total Tasks</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="tasksCompleted">0</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="tasksPending">0</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="currentDate">Today</div>
        <div class="current-time" id="currentTime">00:00:00</div>
        <div class="stat-label">Current Date & Time</div>
      </div>
    </div>

    <div class="content-container">
      <div class="left-panel">
        <div class="add-task-panel">
          <div class="input-group">
            <input type="text" id="taskInput" placeholder="What needs to be done?" />
            <select id="categoryInput">
              <option value="General">General</option>
              <option value="Work">Work</option>
              <option value="Personal">Personal</option>
              <option value="Urgent">Urgent</option>
            </select>
            <input type="date" id="dueDateInput" />
            <input type="time" id="endTimeInput" />
            <select id="priorityInput">
              <option value="Low">Low Priority</option>
              <option value="Medium">Medium Priority</option>
              <option value="High">High Priority</option>
            </select>
            <textarea id="taskDetails" placeholder="Add details about this task..."></textarea>
          </div>
          
          <div class="reminder-toggle">
            <input type="checkbox" id="reminderToggle" />
            <label for="reminderToggle">Set reminder</label>
          </div>
          
          <div class="reminder-fields hidden" id="reminderFields">
            <input type="date" id="reminderDate" />
            <input type="time" id="reminderTime" />
          </div>
          
          <div class="actions">
            <button class="btn btn-primary" onclick="addTask()">
              <i class="fas fa-plus"></i> Add Task
            </button>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <div class="filter-group">
          <input type="text" id="searchInput" placeholder="Search tasks..." oninput="renderTasks()" />
          <select id="statusFilter" onchange="renderTasks()">
            <option value="all">All Tasks</option>
            <option value="completed">Completed</option>
            <option value="incomplete">Incomplete</option>
          </select>
          <select id="sortFilter" onchange="renderTasks()">
            <option value="default">Default Order</option>
            <option value="date">Sort by Due Date</option>
            <option value="priority">Sort by Priority</option>
          </select>
        </div>

        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress" id="progressBar" style="width: 0%"></div>
          </div>
          <div class="progress-stats">
            <span id="progressText">0% complete</span>
            <span id="progressCount">0/0 tasks completed</span>
          </div>
        </div>

        <div class="task-list-container">
          <ul id="taskList"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Task Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Task</h3>
        <button class="modal-close" onclick="closeEditModal()">&times;</button>
      </div>
      <div class="input-group">
        <input type="text" id="editTaskInput" placeholder="Task title" />
        <select id="editCategoryInput">
          <option value="General">General</option>
          <option value="Work">Work</option>
          <option value="Personal">Personal</option>
          <option value="Urgent">Urgent</option>
        </select>
        <input type="date" id="editDueDateInput" />
        <input type="time" id="editEndTimeInput" />
        <select id="editPriorityInput">
          <option value="Low">Low Priority</option>
          <option value="Medium">Medium Priority</option>
          <option value="High">High Priority</option>
        </select>
        <textarea id="editTaskDetails" placeholder="Task details"></textarea>
      </div>
      
      <div class="reminder-toggle">
        <input type="checkbox" id="editReminderToggle" />
        <label for="editReminderToggle">Set reminder</label>
      </div>
      
      <div class="reminder-fields hidden" id="editReminderFields">
        <input type="date" id="editReminderDate" />
        <input type="time" id="editReminderTime" />
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEditedTask()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Toast notification element -->
  <div class="notification-toast" id="notificationToast">
    <div class="notification-toast-header">
      <div class="notification-toast-title" id="notificationTitle">Task Reminder</div>
      <button class="notification-toast-close" onclick="closeNotification()">&times;</button>
    </div>
    <div class="notification-toast-body" id="notificationBody">
      It's time to complete your task!
    </div>
  </div>

  <!-- Audio for notifications -->
  <audio id="notificationSound" preload="auto">
    <source src="bell-notification-337658.mp3" type="audio/mpeg">
  </audio>

  <script>
    // DOM Elements
    const taskInput = document.getElementById('taskInput');
    const taskDetails = document.getElementById('taskDetails');
    const dueDateInput = document.getElementById('dueDateInput');
    const categoryInput = document.getElementById('categoryInput');
    const priorityInput = document.getElementById('priorityInput');
    const endTimeInput = document.getElementById('endTimeInput');
    const reminderToggle = document.getElementById('reminderToggle');
    const reminderFields = document.getElementById('reminderFields');
    const reminderDate = document.getElementById('reminderDate');
    const reminderTime = document.getElementById('reminderTime');
    const taskList = document.getElementById('taskList');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const sortFilter = document.getElementById('sortFilter');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const progressCount = document.getElementById('progressCount');
    const editModal = document.getElementById('editModal');
    const editReminderToggle = document.getElementById('editReminderToggle');
    const editReminderFields = document.getElementById('editReminderFields');
    const editReminderDate = document.getElementById('editReminderDate');
    const editReminderTime = document.getElementById('editReminderTime');
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    const notificationToast = document.getElementById('notificationToast');
    const notificationTitle = document.getElementById('notificationTitle');
    const notificationBody = document.getElementById('notificationBody');
    const notificationSound = document.getElementById('notificationSound');
    const currentTimeElement = document.getElementById('currentTime');
    
    // Stats Elements
    const tasksTotal = document.getElementById('tasksTotal');
    const tasksCompleted = document.getElementById('tasksCompleted');
    const tasksPending = document.getElementById('tasksPending');
    const currentDate = document.getElementById('currentDate');

    // App State
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let currentEditIndex = null;
    let reminderTimers = [];
    
    // Initialize the app
    function init() {
      // Check for notification permission
      checkNotificationPermission();
      
      // Set current date and time in the dashboard
      updateCurrentDate();
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      
      // Initialize reminder toggle functionality
      reminderToggle.addEventListener('change', function() {
        toggleReminderFields(reminderToggle, reminderFields);
      });
      
      editReminderToggle.addEventListener('change', function() {
        toggleReminderFields(editReminderToggle, editReminderFields);
      });
      
      // Check for saved theme preference
      const darkMode = localStorage.getItem('darkMode') === 'true';
      if (darkMode) {
        document.body.classList.add('dark-mode');
        updateThemeUI(true);
      }
      
      // Render initial tasks
      renderTasks();
      
      // Schedule reminders for existing tasks
      scheduleAllReminders();
      
      // Set default date for new reminders 
      const today = new Date().toISOString().split('T')[0];
      reminderDate.min = today;
      reminderDate.value = today;
      
      console.log("TaskCraft initialized successfully");
    }
    
    // Check notification permission
    function checkNotificationPermission() {
      if (!('Notification' in window)) {
        console.log('This browser does not support notifications');
        return;
      }
      
      if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
          console.log('Notification permission:', permission);
        });
      } else {
        console.log('Current notification permission:', Notification.permission);
      }
    }
    
    // Update the current date in dashboard
    function updateCurrentDate() {
      const date = new Date();
      const options = { weekday: 'long', month: 'short', day: 'numeric' };
      currentDate.textContent = date.toLocaleDateString('en-US', options);
    }
    
    // Update the current time in dashboard
    function updateCurrentTime() {
      const date = new Date();
      const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
      currentTimeElement.textContent = date.toLocaleTimeString('en-US', options);
    }
    
    // Toggle reminder fields visibility
    function toggleReminderFields(toggle, fields) {
      if (toggle.checked) {
        fields.classList.remove('hidden');
        fields.classList.add('visible');
      } else {
        fields.classList.remove('visible');
        fields.classList.add('hidden');
      }
    }
    
    // Toggle dark mode
    function toggleDarkMode() {
      const isDarkMode = document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', isDarkMode);
      updateThemeUI(isDarkMode);
    }
    
    // Update theme UI elements
    function updateThemeUI(isDarkMode) {
      if (isDarkMode) {
        themeIcon.className = 'fas fa-sun';
        themeText.textContent = 'Light Mode';
      } else {
        themeIcon.className = 'fas fa-moon';
        themeText.textContent = 'Dark Mode';
      }
    }
    
    // Save tasks to localStorage
    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      scheduleAllReminders();
    }
    
    // Format date in a user-friendly way
    function formatDate(dateString) {
      if (!dateString) return 'No due date';
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      const taskDate = new Date(dateString);
      taskDate.setHours(0, 0, 0, 0);
      
      if (taskDate.getTime() === today.getTime()) {
        return 'Today';
      } else if (taskDate.getTime() === tomorrow.getTime()) {
        return 'Tomorrow';
      } else {
        return new Date(dateString).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }
    }
    
    // Schedule all reminders for tasks
    function scheduleAllReminders() {
      // Clear existing timers
      reminderTimers.forEach(timer => clearTimeout(timer));
      reminderTimers = [];
      
      console.log(`Scheduling reminders for ${tasks.length} tasks`);
      
      // Schedule new timers for each task with reminders
      tasks.forEach((task, index) => {
        if (task.reminder && !task.completed) {
          scheduleReminderForTask(task, index);
        }
      });
    }
    
    // Schedule a reminder for a specific task
    function scheduleReminderForTask(task, index) {
      if (!task.reminderDate || !task.reminderTime) {
        console.log(`Task ${index} has invalid reminder date or time`);
        return;
      }
      
      const reminderDate = new Date(`${task.reminderDate}T${task.reminderTime}`);
      const now = new Date();
      
      console.log(`Task "${task.text}" reminder set for: ${reminderDate.toLocaleString()}`);
      
      if (reminderDate > now) {
        const timeUntilReminder = reminderDate.getTime() - now.getTime();
        console.log(`Reminder will trigger in ${Math.round(timeUntilReminder/1000/60)} minutes`);
        
        const timerId = setTimeout(() => {
          showNotification(task, index);
        }, timeUntilReminder);
        
        reminderTimers.push(timerId);
      } else {
        console.log(`Reminder time already passed for task "${task.text}"`);
      }
    }
    
    // Show notification for a task
    function showNotification(task, index) {
      console.log(`Showing notification for task: ${task.text}`);
      
      // In-app notification
      notificationTitle.textContent = "Reminder: " + task.text;
      notificationBody.textContent = task.details || "It's time to complete your task!";
      
      // Add priority class
      notificationToast.className = "notification-toast";
      notificationToast.classList.add("show");
      notificationToast.classList.add(task.priority.toLowerCase());
      
      // Play sound
      playNotificationSound();
      
      // Close notification after 10 seconds
      setTimeout(() => {
        closeNotification();
      }, 10000);
      
      // Browser notification if permission is granted
      if (Notification.permission === "granted") {
        const notification = new Notification("TaskCraft Reminder", {
          body: task.text,
          icon: "https://cdn.iconscout.com/icon/free/png-256/free-task-1543050-1305395.png"
        });
        
        notification.onclick = function() {
          window.focus();
          notification.close();
        };
      }
    }
    
    // Play the notification sound
    function playNotificationSound() {
      console.log("Playing notification sound");
      notificationSound.currentTime = 0;
      notificationSound.play().catch(e => console.log("Error playing sound:", e));
    }
    
    // Close the notification
    function closeNotification() {
      notificationToast.classList.remove("show");
    }
    
    // Render tasks based on filters
    function renderTasks() {
      const keyword = searchInput.value.toLowerCase();
      const status = statusFilter.value;
      const sort = sortFilter.value;
      
      // Filter tasks
      let filtered = tasks.filter(task => {
        const textMatch = task.text.toLowerCase().includes(keyword) || 
                          (task.details && task.details.toLowerCase().includes(keyword));
        const statusMatch = status === 'all' || 
                           (status === 'completed' && task.completed) || 
                           (status === 'incomplete' && !task.completed);
        return textMatch && statusMatch;
      });
      
      // Sort tasks
      if (sort === 'date') {
        filtered.sort((a, b) => {
          if (!a.dueDate) return 1;
          if (!b.dueDate) return -1;
          return new Date(a.dueDate) - new Date(b.dueDate);
        });
      } else if (sort === 'priority') {
        const order = { 'High': 1, 'Medium': 2, 'Low': 3 };
        filtered.sort((a, b) => order[a.priority] - order[b.priority]);
      }
      
      // Clear task list
      taskList.innerHTML = '';
      
      // Show empty state if needed
      if (filtered.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';
        emptyState.innerHTML = `
          <i class="fas fa-clipboard-list"></i>
          <h3>No tasks found</h3>
          <p>Add a new task or try different filters</p>
        `;
        taskList.appendChild(emptyState);
      } else {
        // Render filtered tasks
        filtered.forEach((task, index) => {
          const actualIndex = tasks.indexOf(task);
          renderTaskItem(task, actualIndex);
        });
      }
      
      // Update stats
      updateStats();
      
      // Set up drag and drop
      setupDragAndDrop();
    }
    
    // Render a single task item
    function renderTaskItem(task, index) {
      const li = document.createElement('li');
      li.className = `task-item priority-${task.priority}`;
      li.setAttribute('draggable', true);
      li.setAttribute('data-index', index);
      
      if (task.completed) {
        li.classList.add('completed');
      }
      
      const formattedDate = formatDate(task.dueDate);
      const hasReminder = task.reminder && task.reminderDate && task.reminderTime;
      
      li.innerHTML = `
        <div class="task-header">
          <h3 class="task-title">${task.text}</h3>
        </div>
        ${task.details ? `<div class="task-details">${task.details}</div>` : ''}
        <div class="task-meta">
          <div class="task-meta-item">
            <i class="fas fa-calendar"></i> ${formattedDate}
          </div>
          ${task.endTime ? `
          <div class="task-meta-item">
            <i class="fas fa-clock"></i> ${formatTime(task.endTime)}
          </div>` : ''}
          <div class="task-meta-item">
            <i class="fas fa-flag"></i> <span class="task-priority">Priority: ${task.priority}</span>
          </div>
          ${hasReminder ? `
          <div class="task-meta-item">
            <i class="fas fa-bell"></i> Reminder: ${formatDate(task.reminderDate)} ${formatTime(task.reminderTime)}
          </div>` : ''}
        </div>
        <div class="task-category category-${task.category}">${task.category}</div>
        ${hasReminder ? `<div class="reminder-badge"><i class="fas fa-bell"></i></div>` : ''}
        <div class="task-controls">
          <button class="task-btn btn-edit" onclick="openEditModal(${index})">
            <i class="fas fa-edit"></i>
          </button>
          <button class="task-btn btn-complete" onclick="toggleComplete(${index})">
            <i class="fas fa-${task.completed ? 'undo' : 'check'}"></i>
          </button>
          <button class="task-btn btn-delete" onclick="deleteTask(${index})">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      `;
      
      taskList.appendChild(li);
    }
    
    // Format time for display
    function formatTime(timeString) {
      if (!timeString) return '';
      
      try {
        const [hours, minutes] = timeString.split(':');
        const date = new Date();
        date.setHours(parseInt(hours, 10));
        date.setMinutes(parseInt(minutes, 10));
        
        return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
      } catch (e) {
        return timeString;
      }
    }
    
    // Update statistics
    function updateStats() {
      const total = tasks.length;
      const completed = tasks.filter(task => task.completed).length;
      const pending = total - completed;
      const percentComplete = total ? Math.round((completed / total) * 100) : 0;
      
      // Update progress bar
      progressBar.style.width = `${percentComplete}%`;
      progressText.textContent = `${percentComplete}% complete`;
      progressCount.textContent = `${completed}/${total} tasks completed`;
      
      // Update dashboard stats
      tasksTotal.textContent = total;
      tasksCompleted.textContent = completed;
      tasksPending.textContent = pending;
    }
    
    // Set up drag and drop functionality
    function setupDragAndDrop() {
      const draggables = document.querySelectorAll('.task-item');
      
      draggables.forEach(item => {
        item.addEventListener('dragstart', dragStart);
        item.addEventListener('dragover', dragOver);
        item.addEventListener('dragleave', dragLeave);
        item.addEventListener('drop', drop);
        item.addEventListener('dragend', dragEnd);
      });
    }
    
    function dragStart(e) {
      e.dataTransfer.setData('text/plain', e.target.dataset.index);
      e.target.classList.add('dragging');
    }
    
    function dragOver(e) {
      e.preventDefault();
      e.target.closest('.task-item')?.classList.add('drag-over');
    }
    
    function dragLeave(e) {
      e.target.closest('.task-item')?.classList.remove('drag-over');
    }
    
    function drop(e) {
      e.preventDefault();
      
      const draggedIndex = parseInt(e.dataTransfer.getData('text/plain'), 10);
      const targetItem = e.target.closest('.task-item');
      
      if (targetItem) {
        targetItem.classList.remove('drag-over');
        const targetIndex = parseInt(targetItem.dataset.index, 10);
        
        if (draggedIndex !== targetIndex) {
          // Reorder the tasks array
          const [movedTask] = tasks.splice(draggedIndex, 1);
          tasks.splice(targetIndex, 0, movedTask);
          
          saveTasks();
          renderTasks();
        }
      }
    }
    
    function dragEnd(e) {
      e.target.classList.remove('dragging');
      document.querySelectorAll('.drag-over').forEach(item => {
        item.classList.remove('drag-over');
      });
    }
    
    // Add a new task
    function addTask() {
      const text = taskInput.value.trim();
      const details = taskDetails.value.trim();
      const dueDate = dueDateInput.value;
      const category = categoryInput.value;
      const priority = priorityInput.value;
      const endTime = endTimeInput.value;
      const hasReminder = reminderToggle.checked;
      const reminderDateValue = reminderDate.value;
      const reminderTimeValue = reminderTime.value;
      
      if (!text) {
        // Shake the input to indicate it's required
        taskInput.classList.add('shake');
        setTimeout(() => taskInput.classList.remove('shake'), 500);
        return;
      }
      
      // Check reminder validity
      if (hasReminder && (!reminderDateValue || !reminderTimeValue)) {
        alert('Please provide both date and time for the reminder');
        return;
      }
      
      // Add new task
      const newTask = {
        text,
        details,
        dueDate,
        endTime,
        category,
        priority,
        completed: false,
        reminder: hasReminder,
        reminderDate: reminderDateValue,
        reminderTime: reminderTimeValue,
        createdAt: new Date().toISOString()
      };
      
      console.log("Adding new task:", newTask);
      tasks.push(newTask);
      
      // Save and render
      saveTasks();
      renderTasks();
      
      // Clear inputs
      taskInput.value = '';
      taskDetails.value = '';
      dueDateInput.value = '';
      endTimeInput.value = '';
      categoryInput.value = 'General';
      priorityInput.value = 'Low';
      reminderToggle.checked = false;
      reminderDate.value = '';
      reminderTime.value = '';
      toggleReminderFields(reminderToggle, reminderFields);
    }
    
    // Toggle task completion
    function toggleComplete(index) {
      tasks[index].completed = !tasks[index].completed;
      saveTasks();
      renderTasks();
    }
    
    // Delete a task
    function deleteTask(index) {
      if (confirm('Are you sure you want to delete this task?')) {
        tasks.splice(index, 1);
        saveTasks();
        renderTasks();
      }
    }
    
    // Open edit modal
    function openEditModal(index) {
      currentEditIndex = index;
      const task = tasks[index];
      
      // Fill form fields
      document.getElementById('editTaskInput').value = task.text;
      document.getElementById('editTaskDetails').value = task.details || '';
      document.getElementById('editDueDateInput').value = task.dueDate || '';
      document.getElementById('editEndTimeInput').value = task.endTime || '';
      document.getElementById('editCategoryInput').value = task.category;
      document.getElementById('editPriorityInput').value = task.priority;
      
      // Fill reminder fields
      editReminderToggle.checked = task.reminder || false;
      editReminderDate.value = task.reminderDate || '';
      editReminderTime.value = task.reminderTime || '';
      toggleReminderFields(editReminderToggle, editReminderFields);
      
      // Show modal
      editModal.classList.add('visible');
    }
    
    // Close edit modal
    function closeEditModal() {
      editModal.classList.remove('visible');
      currentEditIndex = null;
    }
    
    // Save edited task
    function saveEditedTask() {
      if (currentEditIndex === null) return;
      
      const text = document.getElementById('editTaskInput').value.trim();
      
      if (!text) return;
      
      const hasReminder = editReminderToggle.checked;
      const reminderDateValue = editReminderDate.value;
      const reminderTimeValue = editReminderTime.value;
      
      // Check reminder validity
      if (hasReminder && (!reminderDateValue || !reminderTimeValue)) {
        alert('Please provide both date and time for the reminder');
        return;
      }
      
      // Update task
      tasks[currentEditIndex] = {
        ...tasks[currentEditIndex],
        text: text,
        details: document.getElementById('editTaskDetails').value.trim(),
        dueDate: document.getElementById('editDueDateInput').value,
        endTime: document.getElementById('editEndTimeInput').value,
        category: document.getElementById('editCategoryInput').value,
        priority: document.getElementById('editPriorityInput').value,
        reminder: hasReminder,
        reminderDate: reminderDateValue,
        reminderTime: reminderTimeValue
      };
      
      // Save and render
      saveTasks();
      renderTasks();
      
      // Close modal
      closeEditModal();
    }
    
    // Create a test reminder for demonstration (2 minutes from now)
    function createTestReminder() {
      const now = new Date();
      now.setMinutes(now.getMinutes() + 2);
      
      const reminderDate = now.toISOString().split('T')[0];
      const reminderTime = now.toTimeString().substring(0, 5);
      
      console.log(`Creating test reminder for ${reminderDate} ${reminderTime}`);
      
      tasks.push({
        text: "Test Reminder Task",
        details: "This is a test reminder that should trigger in 2 minutes",
        dueDate: reminderDate,
        category: "General",
        priority: "High",
        completed: false,
        reminder: true,
        reminderDate: reminderDate,
        reminderTime: reminderTime,
        createdAt: new Date().toISOString()
      });
      
      saveTasks();
      renderTasks();
      
      alert("Test reminder created! It will trigger in 2 minutes.");
    }
    
    // Add keyboard shortcut for task creation
    document.addEventListener('keydown', function(e) {
      // Ctrl+Enter or Cmd+Enter to add a task when in the input fields
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        if (document.activeElement === taskInput || 
            document.activeElement === taskDetails || 
            document.activeElement === dueDateInput ||
            document.activeElement === endTimeInput) {
          addTask();
        }
      }
    });
    
    // Initialize the app
    window.onload = init;
  </script>
</body>
</html>
